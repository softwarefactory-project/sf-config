---
- name: Setup ~/.ansible.cfg
  copy:
    src: /usr/share/sf-config/ansible/ansible.cfg
    dest: /root/.ansible.cfg
    remote_src: true

- name: Initalize version control for yaml files
  shell: git init .; git add *; git commit -m 'init'
  args:
    chdir: /etc/software-factory/
    creates: /etc/software-factory/.git

- name: Initialize git access
  template:
    src: sshconfig.j2
    dest: /root/.ssh/config

- name: Initialize git config
  template:
    src: gitconfig.j2
    dest: /root/.gitconfig

- name: Remove deprecated backup scripts
  file:
    path: "/usr/local/bin/{{ item.name }}"
    state: absent
  with_items:
    - {name: trigger_backup.sh}
    - {name: export_backup_swift.sh}
    - {name: export_backup_scp.sh}

- name: Remove deprecated auto_backup.conf
  file:
    path: /etc/auto_backup.conf
    state: absent

- name: Remove crontab for backup nightly jobs
  cron:
    name: "{{ item.name }}"
    state: absent
  with_items:
    - {name: backup_gerrit}
    - {name: auto_backup}
    - {name: auto_backup_scp}
