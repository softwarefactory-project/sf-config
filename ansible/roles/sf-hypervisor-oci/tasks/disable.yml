---
- name: List running containers
  command: runc list -q
  register: oci_containers

- name: Delete runC containers
  command: "runc delete --force {{ item }}"
  with_items: "{{ oci_containers.stdout_lines }}"

- name: Unmount rootfs bind mount
  command: umount /var/lib/nodepool/oci/host-rootfs
  ignore_errors: "yes"

- block:
    - name: Remove files
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - /var/lib/zuul/src
        - /var/lib/nodepool/oci
  when: erase == True
