---
- hosts: all
  tasks:
    - name: include arch.yaml
      include_vars:
        file: /opt/sf/arch.yaml
        name: arch

    - name: Checking gerrit replication
      command: git config -f gerrit/replication.config -l
      args:
        chdir: "{{ zuul.project.src_dir }}"

    - name: Checking gerrit commentlinks
      command: python -c "import yaml; 'commentlinks' in yaml.safe_load(open('gerrit/commentlinks.yaml'))"
      args:
        chdir: "{{ zuul.project.src_dir }}"

    - name: Check dashboards
      command: /usr/local/bin/sf-update-dashboard --check --input dashboards/
      args:
        chdir: "{{ zuul.project.src_dir }}"

    - name: Checking syntax errors in repoxplorer definition files
      command: repoxplorer-config-validate --config ../build/repoxplorer/config.py
      args:
        chdir: "{{ zuul.project.src_dir }}"
      when: '"repoxplorer" in arch.roles'

    - name: Checking resources changes
      command: /usr/local/bin/resources.sh validate
      args:
        chdir: "{{ zuul.project.src_dir }}"
