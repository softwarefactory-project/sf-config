---
- name: Check for changes
  command: git status -s
  args:
    chdir: "{{ clone_dir }}"
  changed_when: false
  register: _clone_updated

- name: Push change
  command: "git {{ item }}"
  args:
    chdir: "{{ clone_dir }}"
  with_items:
    - "add -A"
    - "commit -m \"{{ update_message|default('Automatic update of defaults') }}\""
    - "push {{ clone_remote }} master"
  when: _clone_updated.stdout
