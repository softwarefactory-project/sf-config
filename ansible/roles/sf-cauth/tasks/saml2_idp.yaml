---
- name: Check if saml_auth_conf is disabled
  stat:
    path: /etc/httpd/conf.d/saml_auth.conf.disabled
  register: saml_auth_conf_disabled

- name: Enable saml_auth_conf if the configuration is complete
  block:
    - copy:
        remote_src: yes
        src: /etc/httpd/conf.d/saml_auth.conf.disabled
        dest: /etc/httpd/conf.d/saml_auth.conf
      notify: apache reload
    - file:
        path: /etc/httpd/conf.d/saml_auth.conf.disabled
        state: absent
  when: not authentication.SAML2.disabled and saml_auth_conf_disabled.stat.exists
