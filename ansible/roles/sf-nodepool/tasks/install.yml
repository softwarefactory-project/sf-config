---
- name: Check if CentOS system
  set_fact:
    os_repository: centos-release-openshift-origin311
    os_client_package: origin-clients
  when: ansible_distribution == "CentOS"

- name: Check if RedHat system
  set_fact:
    os_repository: rhel-7-server-ose-3.11-rpms
    os_client_package: atomic-openshift-clients
  when: ansible_distribution == "RedHat"

- name: Install launcher package
  yum:
    name: "{{ nodepool_launcher_packages }}"
    state: present
    disablerepo: "{{ yum_disable_repo|default(omit) }}"
    enablerepo: "{{ yum_enable_repo|default(omit) }}"
  when: '"nodepool-launcher" in nodepool_services'

- name: Install builder package
  yum:
    name: "{{ nodepool_builder_packages }}"
    state: present
    disablerepo: "{{ yum_disable_repo|default(omit) }}"
    enablerepo: "{{ yum_enable_repo|default(omit) }}"
  when: '"nodepool-builder" in nodepool_services'

- name: Install package for config-check
  yum:
    name: nodepool
    state: present
    disablerepo: "{{ yum_disable_repo|default(omit) }}"
    enablerepo: "{{ yum_enable_repo|default(omit) }}"
  delegate_to: "{{ item }}"
  loop: "{{ executor_hosts }}"

- name: Install openshift client
  block:
    - name: Install repository
      yum:
        name: '{{ os_repository }}'
        state: present

    - name: Install packages
      yum:
        name: '{{ os_client_package }}'
        state: present
  when: "nodepool_openshift_providers or nodepool_kube_file or 'hypervisor-k1s' in roles"
