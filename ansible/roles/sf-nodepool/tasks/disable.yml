- name: Disable service
  service:
    name: "{{ item }}"
    state: stopped
    enabled: no
  with_items: "{{ nodepool_services }}"
  ignore_errors: yes

- block:
    - name: Remove files
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - /etc/httpd/conf.d/nodepool_log.conf
        - /var/www/nodepool-log
        - /var/lib/nodepool
        - /etc/nodepool
        - /var/log/nodepool

    - name: Remove packages
      yum:
        name: "{{ item }}"
        state: absent
      with_items: "{{ nodepool_packages }}"
  when: erase == True
