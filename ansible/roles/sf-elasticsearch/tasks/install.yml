---
- name: Install requirements
  yum:
    name:
      - java-1.8.0-openjdk
      - elasticsearch-curator
    state: present
    disablerepo: "{{ yum_disable_repo|default(omit) }}"
    enablerepo: "{{ yum_enable_repo|default(omit) }}"

- name: Add the elasticsearch RPM repository
  yum_repository:
    name: "{{ elasticsearch_repo_name }}"
    description: "{{ elasticsearch_repo_desc }}"
    baseurl: "{{ elasticsearch_repo_url }}"
    gpgkey: "{{ elasticsearch_repo_gpgkey }}"
    gpgcheck: "{{ elasticsearch_repo_gpgcheck }}"

- name: Install Elasticsearch package
  yum:
    name: "elasticsearch"
    state: present
    disablerepo: "*"
    enablerepo: "{{ elasticsearch_repo_name }}"

- include_tasks: "{{ sf_tasks_dir }}/check_version.yml"

- name: Get elasticsearch version
  shell: grep -oE '[0-9]' /var/lib/software-factory/versions/sf-elasticsearch  | head -n 1
  register: elasticsearch_version

- include_tasks: bump_version.yml
  when: elasticsearch_version.stdout | int < 5
