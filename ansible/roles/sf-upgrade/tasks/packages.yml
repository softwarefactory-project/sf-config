---
- name: "Install new release repo"
  yum:
    name: "https://softwarefactory-project.io/repos/sf-release-{{ sf_version }}.rpm"
    state: present
    validate_certs: no
  when: sf_version != "master"

- include_tasks: remove_packages.yaml

- name: "Update packages"
  yum:
    name: "*"
    update_cache: "yes"
    state: latest
    exclude:
      - ansible
      # https://softwarefactory-project.io/etherpad/p/sf-config-update_pike_queens
      - python-django-bash-completion
    disablerepo: '{{ yum_disable_repo|default(omit) }}'
    enablerepo: '{{ yum_enable_repo|default(omit) }}'
