---
- name: Check for unconfined process
  shell: ps auxZ | grep -i "unconfin"  > /var/log/audit/unconfined_process.txt

- name: "Create {{ inventory_hostname }} base logs directory"
  file:
    path: "{{ log_dest }}/{{ inventory_hostname }}"
    state: directory

- name: Fetch system logs
  synchronize:
    mode: pull
    src: "{{ item }}"
    dest: "{{ log_dest }}/{{ inventory_hostname }}/"
  ignore_errors: true
  with_items:
    - /var/log/messages
    - /var/log/audit/audit.log
    - /var/log/audit/unconfined_process.txt
    - /var/log/cloud-init.log
    - /var/log/cloud-init-output.log
