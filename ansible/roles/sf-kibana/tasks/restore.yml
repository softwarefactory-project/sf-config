---
- name: Send restore script
  copy:
    src: kibana-backup.py
    dest: /usr/local/bin/kibana-backup.py
    mode: '0755'

- name: Check if Kibana service is alive
  wait_for:
    host: "{{ kibana_host }}"
    port: 5601
    timeout: 1
  register: kibana_status
  ignore_errors: true

- name: Restore objects from backup
  command: |
    /usr/local/bin/kibana-backup.py --kibana-url "{{ kibana_internal_url }}" --restore-file {{ kibana_backup_dir }}/backup.ndjson restore
  when: kibana_status is successful
