---
- name: Disable services
  service:
    name: "{{ item }}"
    state: stopped
    enabled: "no"
  with_items: "{{ zuul_services }}"
  ignore_errors: "yes"

- name: Disable legacy zuul service too
  service:
    name: zuul
    state: stopped
    enabled: "no"
  ignore_errors: "yes"

- block:
    - name: Remove files
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - /etc/httpd/conf.d/zuul.conf
        - /etc/httpd/conf.d/zuul-merger.conf
        - /var/lib/zuul/ansible
        - /var/lib/zuul/git
        - /var/lib/zuul/jenkins
        - /var/lib/zuul/times
        - /var/lib/zuul/jobs/config-check
        - /var/lib/zuul/jobs/config-update
        - /var/lib/zuul/.ssh/known_hosts
        - /etc/zuul

    - name: Remove packages
      yum:
        name: "{{ item }}"
        state: absent
      with_items: "{{ zuul_packages }}"
  when: erase == True
