<IfModule mod_proxy.c>
    # Elasticsearch doew not accept http requests
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off

{% if 'cauth' in roles %}
    # For Opendistro 1.9
    <Location "/analytics/login">
        RequestHeader unset X-Remote-User
        AuthType mod_auth_pubtkt
        TKTAuthLoginURL /auth/login
        TKTAuthFakeBasicAuth on
        TKTAuthDebug 1
        require valid-user
    </Location>
    # For Opendistro 1.10
    <Location "/analytics/app/login">
        RequestHeader unset X-Remote-User
        AuthType mod_auth_pubtkt
        TKTAuthLoginURL /auth/login
        TKTAuthFakeBasicAuth on
        TKTAuthDebug 1
        require valid-user
    </Location>
{% endif %}
    <Location "/analytics">
        ProxyPass {{ kibana_internal_url }}
        ProxyPassReverse {{ kibana_internal_url }}
    </Location>
    <Location /elasticsearch>
        ProxyPass {{ elasticsearch_internal_url }}
        ProxyPassReverse {{ elasticsearch_internal_url }}
    </Location>
</IfModule>
