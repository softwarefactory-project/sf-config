[gearman]
server={{ zuul3_scheduler_host }}

[zookeeper]
hosts={{ zookeeper_host }}:2181

[gearman_server]
start=true
log_config={{ zuul3_conf_dir }}/gearman-logging.conf

[scheduler]
state_dir={{ zuul3_lib_dir }}
tenant_config={{ zuul3_conf_dir }}/main.yaml
log_config={{ zuul3_conf_dir }}/scheduler-logging.conf

[merger]
state_dir={{ zuul3_lib_dir }}
git_dir={{ zuul3_lib_dir }}/git/
git_user_email=zuul@{{ fqdn }}
git_user_name=zuul
zuul_url={{ host_public_url }}/p
log_config={{ zuul3_conf_dir }}/merger-logging.conf

[executor]
state_dir={{ zuul3_lib_dir }}
git_dir={{ zuul3_lib_dir }}/executor/
finger_port=7979
trusted_ro_dirs=/opt/:/etc/hosts:/etc/nsswitch.conf
untrusted_ro_dirs=/opt/:/etc/hosts:/etc/nsswitch.conf
log_config={{ zuul3_conf_dir }}/executor-logging.conf

[web]
listen_address=127.0.0.1
port=9000
log_config={{ zuul3_conf_dir }}/web-logging.conf

[webapp]
listen_address=0.0.0.0
port={{ zuul3_webapp_port }}
status_url={{ zuul3_pub_url }}

[connection sqlreporter]
driver=sql
dburi=mysql+pymysql://{{ zuul3_mysql_user }}:{{ zuul3_mysql_password}}@{{ zuul3_mysql_host }}/{{ zuul3_mysql_db }}

[connection gerrit]
driver=gerrit
server={{ gerrit_host }}
# baseurl is only use to fetch git refs on diff url than server.
# Using baseurl we cannot modify url zuul report to user
baseurl={{ gerrit_pub_url }}
user=zuul
sshkey={{ zuul3_lib_dir }}/.ssh/id_rsa

{% for conn in zuul3_extra_gerrits|default([]) %}
[connection {{ conn['name'] }}]
driver=gerrit
port={{ conn['port']|default('29418') }}
server={{ conn['hostname'] }}
baseurl={{ conn['puburl'] }}
user={{ conn['username'] }}
sshkey={{ zuul3_lib_dir }}/.ssh/id_rsa

{% endfor %}

{% for conn in zuul3_github_connections|default([]) %}
[connection {{ conn['name'] }}]
driver=github
git_host={{ conn['hostname']|default('github.com') }}
port={{ conn['port']|default('22') }}
api_token={{ conn['api_token'] }}
webhook_token={{ conn['webhook_token'] }}
sshkey={{ zuul3_lib_dir }}/.ssh/id_rsa

{% endfor %}

[connection smtp]
driver=smtp
server=localhost
port=25
default_from=zuul@{{ fqdn }}
default_to=admin@{{ fqdn }}
