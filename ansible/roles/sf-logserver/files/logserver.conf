AddType text/plain .log
AddType text/plain .sh
AddType text/plain .yaml
AddType text/plain .yml

DocumentRoot /var/www/

<Directory "/var/www/logs/">
    Options Indexes SymLinksIfOwnerMatch
    Require all granted
    IndexOptions FancyIndexing HTMLTable NameWidth=* SuppressDescription
    HeaderName /static/index-header.html
</Directory>

<FilesMatch \.html\.gz$>
  ForceType text/html
  AddDefaultCharset UTF-8
  AddEncoding x-gzip gz
</FilesMatch>
<FilesMatch \.css\.gz$>
  ForceType text/css
  AddDefaultCharset UTF-8
  AddEncoding x-gzip gz
</FilesMatch>
<FilesMatch \.js\.gz$>
  ForceType text/javascript
  AddDefaultCharset UTF-8
  AddEncoding x-gzip gz
</FilesMatch>
<FilesMatch \.ttf\.gz$>
  ForceType application/x-font-ttf
  AddEncoding x-gzip gz
</FilesMatch>
<FilesMatch \.svg\.gz$>
  ForceType image/svg+xml
  AddEncoding x-gzip gz
</FilesMatch>
<FilesMatch \.json\.gz$>
  ForceType application/json
  AddEncoding x-gzip gz
</FilesMatch>
<FilesMatch \.css$>
  # mod_mime_magic is sometimes passing css files as asm sources
  # e.g css files generated by coverage reports
  ForceType text/css
</FilesMatch>

<LocationMatch "/logs/">
    RewriteEngine On

    # Redirect plain text file to htmlify middleware
    RewriteRule ^/var/www/logs/(.*console\.html)$ /htmlify/$1 [QSA,L,PT]
    RewriteRule ^/var/www/logs/(.*\.txt\.gz)$ /htmlify/$1 [QSA,L,PT]

    # Implicit redirect from ara directories to the index file
    RewriteRule ^/var/www/logs/(.*)/ara/$ /logs/$1/ara/index.html.gz [QSA,L,PT]
    RewriteRule ^/var/www/logs/(.*)/ara/(file|result)/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/$ /logs/$1/ara/$2/$3/index.html.gz [QSA,L,PT]

    # Serve gzipped static file requested w/o the .gz extention
    RewriteCond %{HTTP:Accept-Encoding} gzip
    RewriteCond /var/www/%{REQUEST_URI}.gz -f
    RewriteRule ^(.*)$ $1.gz [L,PT]
</LocationMatch>

Alias "/logs-raw" "/var/www/logs"

<Directory "/usr/lib/python2.7/site-packages/os_loganalyze/">
    Require all granted
</Directory>
SetEnv OS_LOGANALYZE_ROOT_PATH /var/www/logs/
WSGIScriptAlias /htmlify /usr/lib/python2.7/site-packages/os_loganalyze/wsgi.py
