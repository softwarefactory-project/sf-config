---
# This file is managed by ansible, don't edit

- hosts: localhost
  connection: local
  tasks:
    - pause:
        prompt: "WARNING: this playbook will *DESTROY* software factory data, press ENTER to continue or CTRL-C to abort"
      when: sfconfig_batch is not defined

# Call disable tasks with erase flag on
{% for host in inventory %}
- hosts: {{ host['hostname'] }}
  roles:
{% for role in host['rolesname'] %}
{% if role != 'sf-mysql' and role != 'sf-install-server' %}
    - name: "{{ role }}"
      action: disable
      erase: True
{% for key, value in host['params'].items() %}
      {{ key }}: {{ value }}
{% endfor %}
{% endif %}{% endfor %}

{% endfor %}
# Disable mysql after services
- hosts: mysql
  roles:
    - name: sf-mysql
      action: disable
      erase: True

# Disable install-server after mysql
- hosts: install-server
  roles:
    - name: sf-install-server
      action: disable
      erase: True

# Disable base at last (removes sf-config)
- hosts: all
  roles:
    - name: sf-base
      action: disable
      erase: True

- hosts: all
  tasks:
    - file:
        path: "{{'{{'}} item {{'}}'}}"
        state: absent
      with_items:
        - /var/lib/software-factory/sql
        - /var/lib/software-factory/state
        - /var/lib/software-factory/.version
        - /var/lib/software-factory/bootstrap-data/secrets.yaml
        - /var/lib/software-factory/ansible
