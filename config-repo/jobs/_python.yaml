---
- job-template:
    name: '{name}-upload-to-pypi'
    defaults: global
    builders:
      - prepare-workspace
      - shell: |
          cp $PYPIRC ~/.pypirc
          sudo pip install --upgrade setuptools pip twine
          cd $ZUUL_PROJECT
          python setup.py sdist bdist_wheel
          twine upload dist/*
    wrappers:
      - credentials-binding:
          - file:
              credential-id: '{pypirc}'
              variable: PYPIRC
    triggers:
      - zuul
    node: '{node}'
